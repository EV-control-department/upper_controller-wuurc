# 任务模式配置指南

本文档提供有关如何配置和自定义ROV控制系统中的任务模式的信息。

## 模式配置文件

系统支持通过配置文件定制四种不同的任务模式。这些配置文件位于 `config/modes/` 目录中，每个模式对应一个单独的INI文件。

### 文件命名

模式配置文件应遵循以下命名约定：

```
mode_[任务名称].ini
```

例如：

- `mode_conch_harvesting.ini` - 海螺捕捞任务
- `mode_precision_operation.ini` - 精确作业任务
- `mode_net_recovery.ini` - 回收网箱任务
- `mode_feed_distribution.ini` - 饲料投放任务

### 配置文件格式

每个模式配置文件应包含以下几个部分：

```ini
[mode]
name = 1.海螺捕捞     # 模式名称（应以数字开头，用于排序）
servoX = 0.85        # X舵机位置（0.0-1.0）
servoY = 0.79        # Y舵机位置（0.0-1.0）
color = #e800b6      # 界面显示颜色（十六进制RGB格式）

[axis_max]
x = 4000             # X轴最大值
y = 6000             # Y轴最大值
z = 8000             # Z轴最大值

[trigger]
left_threshold = -0.5 # 左扳机阈值，超过此值自动进入Mild模式
x_reduction = 4       # X轴减幅系数
y_reduction = 8       # Y轴减幅系数
z_reduction = 8       # Z轴减幅系数
```

## 参数说明

### [mode] 部分

- **name**: 模式的显示名称。建议以数字开头（如"1."），这样系统可以按数字顺序排序模式。
- **servoX**: X舵机的位置值，范围从0.0到1.0。
- **servoY**: Y舵机的位置值，范围从0.0到1.0。
- **color**: 在用户界面中显示此模式时使用的颜色，使用十六进制RGB格式（如"#FF0000"表示红色）。

### [axis_max] 部分

- **x**: X轴（左右）的最大值，影响ROV的左右移动速度。
- **y**: Y轴（前后）的最大值，影响ROV的前后移动速度。
- **z**: Z轴（上下）的最大值，影响ROV的上下移动速度。

### [trigger] 部分

- **left_threshold**: 左扳机阈值，当左扳机值大于此阈值时，自动切换到Mild模式（低速模式）。范围通常为-1.0到0.0。
- **x_reduction**: X轴减幅系数，值越大减幅越大。当左扳机被按下时，X轴的输出会按照公式
  `* (1 - (left_trigger_value + 1) / x_reduction)` 进行减幅。
- **y_reduction**: Y轴减幅系数，值越大减幅越大。
- **z_reduction**: Z轴减幅系数，值越大减幅越大。

## 添加新模式

要添加新的任务模式：

1. 在 `config/modes/` 目录中创建一个新的INI文件，遵循上述命名约定。
2. 在文件中添加 `[mode]`、`[axis_max]` 和 `[trigger]` 部分并定义所需参数。
3. 重启应用程序以加载新模式。

### 示例配置

以下是一个完整的模式配置示例，适用于精确操作任务：

```ini
[mode]
name = 2.精确作业
servoX = 0.99
servoY = 0.79
color = #00d5e8

[axis_max]
x = 3000
y = 4000
z = 6000

[trigger]
left_threshold = -0.4
x_reduction = 6
y_reduction = 10
z_reduction = 10
```

这个配置为精确作业任务提供了较低的最大速度值和较高的减幅系数，使ROV在此模式下能够进行更精确的操作。

## 修改现有模式

要修改现有任务模式的参数：

1. 打开相应的模式配置文件。
2. 更改所需参数的值。
3. 保存文件并重启应用程序以应用更改。

## 故障排除

如果模式未正确加载：

1. 确保配置文件位于正确的目录（`config/modes/`）。
2. 检查文件名是否以 `mode_` 开头并以 `.ini` 结尾。
3. 验证文件内容是否包含 `[mode]` 部分和所有必需参数。
4. 检查参数值是否在有效范围内。

如果新增的 `[axis_max]` 或 `[trigger]` 部分出现问题：

1. 这些部分是可选的，如果缺失或参数无效，系统将使用默认值。
2. 确保数值参数使用正确的格式（例如，使用小数点而不是逗号）。
3. 对于 `left_threshold`，确保值在 -1.0 到 0.0 之间。
4. 对于减幅系数，建议使用 3-10 之间的值，值越大减幅越大。

如果所有模式配置文件都无法加载，系统将回退到默认的硬编码模式。

## 参数调优建议

根据不同任务的需求，可以按照以下原则调整参数：

1. **精确操作任务**：使用较低的轴最大值和较高的减幅系数，使ROV移动更加精确。
2. **力量需求任务**（如网箱回收）：使用较高的轴最大值和较低的减幅系数，提供更大的推力。
3. **左扳机阈值**：根据操作员习惯调整，值越接近0，越容易触发Mild模式；值越接近-1，需要更大的扳机压力才能触发。
4. **减幅系数差异**：通常X轴（左右）的减幅系数小于Y轴和Z轴，这样可以在精细操作时保持更好的横向控制。