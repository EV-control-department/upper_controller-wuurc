# 手柄辅助修正功能

## 功能概述

手柄辅助修正功能旨在减少操作手快速拨动摇杆时的非主要方向移动，提高操作精度。当操作手从静止状态快速拨动摇杆时，系统会检测主要移动方向，并对次要方向应用过滤，以减少"
顺带现象"（例如推z轴附带yaw转向，推y轴带有x横移）。

## 工作原理

1. **检测静止到移动的状态变化**：系统监控摇杆状态，当从静止状态（所有轴值接近零）快速移动到超过检测阈值时，触发辅助修正。

2. **确定主要移动方向**：系统分析摇杆移动的主要方向（哪个轴的值变化最大），并将其标记为主要方向。

3. **应用指数过滤**：在短时间内（默认0.5秒），对非主要方向应用指数过滤，减弱其影响，同时保持主要方向的响应不变。

4. **独立分析两个摇杆**：左摇杆（X/Y轴）和右摇杆（Z/Yaw轴）独立分析和处理，互不干扰。

## 使用方法

### 启用/禁用功能

有两种方式可以切换辅助修正功能的启用状态：

1. **键盘快捷键**：按下 `J` 键切换辅助修正功能的启用/禁用状态。
2. **手柄按钮**：按下左摇杆（按钮8）切换辅助修正功能的启用/禁用状态。

当切换状态时，控制台会显示当前状态信息：

```
手柄辅助修正: 已启用
```

或

```
手柄辅助修正: 已禁用
```

### 配置参数

辅助修正功能的参数可以在配置文件 `config_beyond.ini` 中的 `[joystick_correction]` 部分进行调整：

```ini
[joystick_correction]
detection_threshold = 0.1    # 检测阈值，当摇杆值超过此阈值时触发检测
stationary_threshold = 0.05  # 静止阈值，当摇杆值低于此阈值时视为静止
correction_duration = 0.5    # 修正持续时间（秒），在此时间内应用修正
filter_strength = 2.0        # 过滤强度（指数），值越大过滤效果越强
```

## 参数调整建议

根据不同的操作习惯和需求，可以调整以下参数：

1. **检测阈值（detection_threshold）**：
    - 增大：减少误触发，但可能导致快速小幅度移动不被修正
    - 减小：增加灵敏度，但可能导致误触发

2. **静止阈值（stationary_threshold）**：
    - 增大：更容易回到静止状态，但可能导致小幅度操作被忽略
    - 减小：更精确地检测静止状态，但可能导致摇杆难以回到静止状态

3. **修正持续时间（correction_duration）**：
    - 增大：延长修正效果，但可能影响后续操作
    - 减小：缩短修正效果，更快恢复正常控制

4. **过滤强度（filter_strength）**：
    - 增大：更强的过滤效果，次要方向移动更少
    - 减小：更弱的过滤效果，保留更多的次要方向移动

## 技术实现

辅助修正功能通过以下组件实现：

1. **JoystickCorrection类**：实现核心修正算法，位于 `modules/joystick_correction.py`
2. **JoystickController集成**：在 `modules/joystick_controller.py` 中集成修正功能
3. **配置支持**：在 `config_beyond.ini` 中添加相关配置
4. **UI控制**：在 `modules/ui_controller.py` 中添加键盘快捷键支持

## 注意事项

1. 辅助修正功能默认为禁用状态，需要手动启用。
2. 修正功能仅在快速从静止状态移动摇杆时生效，不会影响正常的持续操作。
3. 如果感觉修正效果过强或过弱，可以调整配置文件中的参数。
4. 该功能旨在辅助操作，不会完全消除所有非预期的移动。