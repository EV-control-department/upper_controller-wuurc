# 推力曲线调试工具使用指南

## 概述

推力曲线调试工具是一个用于可视化和调整 ROV 电机推力曲线参数的图形界面应用程序。该工具允许用户实时查看和修改曲线参数，并将更改保存到配置文件中。

## 功能特点

- 可视化显示电机推力曲线
- 同时显示原始曲线和修改后的曲线进行对比
- 显示控制器曲线函数的映射效果
- 支持调整所有曲线参数并实时预览效果
- 支持将一个电机的参数应用到所有电机
- 支持加载和保存配置文件

## 安装要求

- Python 3.8+
- PyQt5
- NumPy
- 项目依赖项（通过 `requirements.txt` 安装）

## 启动方法

有两种方式启动推力曲线调试工具：

1. **使用批处理文件**：
    - 双击 `tools/start_thrust_curve_debugger.bat` 文件

2. **使用命令行**：
   ```bash
   cd path/to/upper_controller-wuurc_V2.0
   python tools/thrust_curve_debugger.py
   ```

## 界面说明

推力曲线调试工具的界面分为以下几个部分：

### 顶部工具栏

- **选择电机**：从下拉菜单中选择要编辑的电机（m0-m5）
- **显示选项**：
    - 显示原始曲线：切换显示/隐藏原始曲线
    - 显示修改后曲线：切换显示/隐藏修改后的曲线
- **文件操作**：
    - 加载配置：从文件加载曲线配置
    - 保存配置：将当前曲线配置保存到文件

### 曲线可视化区域

左侧的曲线可视化区域显示以下内容：

- **坐标系**：横轴表示输入值（-1 到 1），纵轴表示输出值（归一化）
- **控制器曲线**（绿色）：显示 controller_curve 函数的映射效果
- **原始曲线**（蓝色）：显示加载时的原始曲线参数
- **修改后曲线**（红色）：显示当前修改后的曲线参数
- **图例**：显示各曲线的颜色和名称

### 参数编辑区域

右侧的参数编辑区域包含以下内容：

- **位置参数**：
    - 负向中点 (np_mid)
    - 负向初始点 (np_ini)
    - 正向初始点 (pp_ini)
    - 正向中点 (pp_mid)
- **推力参数**：
    - 负向终点 (nt_end)
    - 负向中点 (nt_mid)
    - 正向中点 (pt_mid)
    - 正向终点 (pt_end)
- **操作按钮**：
    - 重置参数：将当前电机的参数重置为默认值
    - 应用到所有电机：将当前电机的参数应用到所有电机

### 状态栏

底部的状态栏显示操作状态和提示信息。

## 使用流程

1. 启动工具后，默认加载 `config/curve.json` 文件中的曲线配置
2. 从下拉菜单中选择要编辑的电机
3. 调整参数值，曲线可视化区域会实时更新显示效果
4. 使用"重置参数"按钮可以将参数恢复为默认值
5. 使用"应用到所有电机"按钮可以将当前电机的参数应用到所有电机
6. 完成调整后，使用"保存配置"按钮将更改保存到文件

## 参数说明

曲线参数分为位置参数和推力参数两组：

### 位置参数

位置参数控制电机的位置控制曲线：

- **np_mid**：负向中点位置
- **np_ini**：负向初始点位置
- **pp_ini**：正向初始点位置
- **pp_mid**：正向中点位置

### 推力参数

推力参数控制电机的推力输出曲线：

- **nt_end**：负向终点推力
- **nt_mid**：负向中点推力
- **pt_mid**：正向中点推力
- **pt_end**：正向终点推力

## 曲线原理

推力曲线使用贝塞尔曲线将输入值（-1 到 1）映射到输出值。曲线分为两部分：

1. **负向部分**：从 (-1, nt_end) 经过 (-0.5, nt_mid) 到 (0, 0)
2. **正向部分**：从 (0, 0) 经过 (0.5, pt_mid) 到 (1, pt_end)

控制器曲线函数 `controller_curve` 提供了一个非线性映射，用于增强控制精度：

- 正向输入：y = x^5
- 负向输入：y = -((-x)^3)

## 故障排除

如果遇到以下问题，请尝试相应的解决方法：

1. **工具无法启动**：
    - 确保已安装所有依赖项
    - 检查 Python 版本是否为 3.8+
    - 检查 PyQt5 和 NumPy 是否正确安装

2. **无法加载配置文件**：
    - 确保 `curve.json` 文件存在且格式正确
    - 检查文件权限是否允许读取

3. **无法保存配置文件**：
    - 确保目标目录有写入权限
    - 检查磁盘空间是否充足

4. **曲线显示异常**：
    - 检查参数值是否在合理范围内
    - 尝试重置参数到默认值

## 开发信息

推力曲线调试工具使用 PyQt5 开发，主要包含以下组件：

- **CurveVisualizerWidget**：曲线可视化组件
- **MotorCurveEditor**：参数编辑组件
- **ThrustCurveDebugger**：主窗口类

如需扩展功能，可以修改 `thrust_curve_debugger.py` 文件。