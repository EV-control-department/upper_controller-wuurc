# 推力曲线调试器 (Thrust Curve Debugger) 更新文档

## 更新概述

根据需求，我们对 `thrust_curve_debugger.py` 进行了重构，将水平电机的布局从辐射状发散改为前后对称布局，并重新计算了 X、Y、Z
轴的推力矩阵。这些更改使得前面两个电机的推水线相交于机器人前侧，后面两个电机的推水线相交于机器人后侧，从而提高了推进效率和控制精度。

## 具体更改

### 1. 电机位置布局

**原始布局**：

- 四个水平电机呈辐射状布局，分别位于 0°、90°、180°、270° 角度
- 电机位置：
  - m0: [1, 0, 0] - 右侧 (0度角)
  - m1: [0, -1, 0] - 后侧 (270度角)
  - m2: [-1, 0, 0] - 左侧 (180度角)
  - m3: [0, 1, 0] - 前侧 (90度角)

**新布局**：

- 四个水平电机呈菱形布局，分别位于 45°、135°、225°、315° 角度
- 电机位置：
  - m0: [0.7, 0.7, 0] - 右前 (45度角)
  - m1: [0.7, -0.7, 0] - 右后 (315度角)
  - m2: [-0.7, -0.7, 0] - 左后 (225度角)
  - m3: [-0.7, 0.7, 0] - 左前 (135度角)

### 2. 电机方向更新

**原始方向**：

- m0: [1, 0, 0] - 沿 X 轴正方向
- m1: [0, -1, 0] - 沿 Y 轴负方向
- m2: [-1, 0, 0] - 沿 X 轴负方向
- m3: [0, 1, 0] - 沿 Y 轴正方向

**中间方向**（菱形布局）：

- m0: [1, 1, 0]/√2 - 45° 方向
- m1: [1, -1, 0]/√2 - 315° 方向
- m2: [-1, -1, 0]/√2 - 225° 方向
- m3: [-1, 1, 0]/√2 - 135° 方向

**最终方向**（前后对称布局）：

- m0: [-0.5, 1, 0]/√1.25 - 右前，推水线指向前方中心
- m1: [0.5, -1, 0]/√1.25 - 右后，推水线指向后方中心
- m2: [-0.5, -1, 0]/√1.25 - 左后，推水线指向后方中心
- m3: [0.5, 1, 0]/√1.25 - 左前，推水线指向前方中心

### 3. 推力计算矩阵重构

**原始推力计算**：
```python
motor_thrusts = {
    'm0': x,         # 右侧 - 控制X轴正向
    'm1': -y,        # 后侧 - 控制Y轴负向
    'm2': -x,        # 左侧 - 控制X轴负向
    'm3': y,         # 前侧 - 控制Y轴正向
    'm4': z,         # 上前 - 控制Z轴
    'm5': z          # 上后 - 控制Z轴
}

# 添加偏航(Yaw)的影响
motor_thrusts['m0'] += yaw
motor_thrusts['m1'] += yaw
motor_thrusts['m2'] -= yaw
motor_thrusts['m3'] -= yaw
```

**中间推力计算**（菱形布局）：
```python
# 系数0.7071约等于1/sqrt(2)，用于45°角的分量分解
coef = 0.7071

motor_thrusts = {
    # 右前 (45°) - 贡献x正向和y正向
    'm0': x * coef + y * coef,
    # 右后 (315°) - 贡献x正向和y负向
    'm1': x * coef - y * coef,
    # 左后 (225°) - 贡献x负向和y负向
    'm2': -x * coef - y * coef,
    # 左前 (135°) - 贡献x负向和y正向
    'm3': -x * coef + y * coef,
    # 垂直电机控制Z轴
    'm4': z,
    'm5': z
}

# 添加偏航(Yaw)的影响 - 所有水平电机都参与偏航控制
# 顺时针旋转：m0和m2推力增加，m1和m3推力减少
motor_thrusts['m0'] += yaw
motor_thrusts['m2'] += yaw
motor_thrusts['m1'] -= yaw
motor_thrusts['m3'] -= yaw
```

**最终推力计算**（前后对称布局）：
```python
# 归一化系数
norm_factor = np.sqrt(1.25)

# x分量系数
x_coef_m0 = -0.5 / norm_factor
x_coef_m1 = 0.5 / norm_factor
x_coef_m2 = -0.5 / norm_factor
x_coef_m3 = 0.5 / norm_factor

# y分量系数
y_coef_m0 = 1.0 / norm_factor
y_coef_m1 = -1.0 / norm_factor
y_coef_m2 = -1.0 / norm_factor
y_coef_m3 = 1.0 / norm_factor

motor_thrusts = {
    # 右前 - 推水线指向前方中心
    'm0': x * x_coef_m0 + y * y_coef_m0,
    # 右后 - 推水线指向后方中心
    'm1': x * x_coef_m1 + y * y_coef_m1,
    # 左后 - 推水线指向后方中心
    'm2': x * x_coef_m2 + y * y_coef_m2,
    # 左前 - 推水线指向前方中心
    'm3': x * x_coef_m3 + y * y_coef_m3,
    # 垂直电机控制Z轴
    'm4': z,
    'm5': z
}

# 添加偏航(Yaw)的影响 - 所有水平电机都参与偏航控制
# 顺时针旋转：m0和m2推力增加，m1和m3推力减少
motor_thrusts['m0'] += yaw
motor_thrusts['m2'] += yaw
motor_thrusts['m1'] -= yaw
motor_thrusts['m3'] -= yaw
```

## 技术原理

### 前后对称布局设计

在最终的前后对称布局中，我们采用了一种特殊的电机方向设计：

1. 前部两个电机(m0和m3)的推水线相交于机器人前侧中心点
2. 后部两个电机(m1和m2)的推水线相交于机器人后侧中心点
3. 这种设计使得机器人在前进和后退时能够获得更集中的推力

### 向量投影原理

我们使用向量投影原理将 X 和 Y 方向的推力分解到各个电机的方向上：

1. 对于前后对称布局，每个电机的方向向量都经过精确计算，使其推水线指向前部或后部中心
2. 每个电机的方向向量被归一化（除以√1.25），确保单位长度
3. X和Y分量根据电机的具体方向进行正负调整
4. 将分解后的分量相加得到该电机的总推力

### 偏航控制优化

在新的布局中，偏航控制也进行了优化：

- 顺时针旋转：m0(右前)和m2(左后)推力增加，m1(右后)和m3(左前)推力减少
- 逆时针旋转：m0(右前)和m2(左后)推力减少，m1(右后)和m3(左前)推力增加

这种配置可以产生更平衡的偏航力矩，提高旋转控制的精度。

## 优势

1. **提高前进/后退效率**：前后对称布局使得前进和后退时推力更加集中，提高了推进效率
2. **改善方向控制**：前部两个电机推水线相交于前方，后部两个电机推水线相交于后方，使得转向更加精确
3. **减少推力损失**：推水线的交汇设计减少了推力的相互抵消，提高了能源利用效率
4. **增强稳定性**：前后对称的推力分布使得机器人在运动中更加稳定
5. **优化偏航控制**：新的偏航控制策略提供了更平衡的旋转力矩

## 后续建议

1. 进行实际测试，验证前后对称布局的性能表现，特别是前进/后退效率
2. 根据测试结果微调推力系数和电机方向角度
3. 考虑在实际硬件控制器中应用相同的推力计算矩阵
4. 评估不同速度下的推力效率，可能需要针对高速和低速场景优化参数
5. 考虑添加可视化工具，实时显示推水线的交汇点，以便更直观地调整和优化